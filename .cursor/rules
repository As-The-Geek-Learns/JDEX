# Ironclad Development Workflow

You are operating under a structured 4-phase workflow: PLAN -> EXECUTE -> VERIFY -> SHIP.
Each phase has gates that must be satisfied before proceeding.

## WORKFLOW PHASES

### Phase 1: PLAN
Before writing any code, create or update a plan document.

**Required:**
- Create `.workflow/sessions/SESSION-YYYY-MM-DD-[slug]/plan.md` using the template
- Define problem statement and success criteria
- Complete security considerations section
- Break down tasks with dependencies
- Get human approval before proceeding

**Gate:** Human must approve the plan before EXECUTE phase begins.

### Phase 2: EXECUTE
Implement the planned tasks systematically.

**Required:**
- Work through tasks in dependency order
- Create feature branch for the work
- Update session documentation as you go
- Mark tasks complete in plan.md as finished
- Run linting and fix issues before proceeding

**Gate:** All planned tasks must be marked complete before VERIFY phase.

### Phase 3: VERIFY
Validate the implementation thoroughly.

**Required:**
- Run `node scripts/verify.js` to generate file hashes
- Complete verification checklist
- Run all automated tests
- Perform visual verification (capture screenshots if UI)
- Complete security review checklist
- Get human approval of verification results

**Gate:** Human must approve verification before SHIP phase.

### Phase 4: SHIP
Merge and release the verified code.

**Required:**
- Run `node scripts/ship.js` to validate file integrity
- File hashes must match verification state
- Create PR using the PR template
- Include verification evidence in PR
- Human approves final merge

**Gate:** File integrity must pass before PR creation.

## HUMAN CHECKPOINTS

The workflow has mandatory human checkpoints:
1. **Plan Approval** - Before any code is written
2. **Verification Approval** - After testing, before shipping
3. **Ship Approval** - Final merge decision

Never auto-proceed past these checkpoints. Always ask for explicit approval.

## SECURITY REQUIREMENTS

For every change:
- Review `.workflow/checklists/security-review.md`
- Validate all user inputs
- Sanitize data before storage/display
- Use parameterized queries for database operations
- Never expose sensitive data in errors or logs
- Run `npm audit` before shipping

## SESSION MANAGEMENT

Each development session should:
1. Reference or create a plan document
2. Create session documentation using the template
3. Track all changes made
4. Document any issues encountered
5. Update verification status

## FILE STRUCTURE

```
.workflow/
├── templates/           # Document templates (DO NOT MODIFY)
│   ├── plan-template.md
│   ├── session-template.md
│   └── pr-template.md
├── checklists/          # Review checklists
│   ├── security-review.md
│   └── verify-checklist.md
├── sessions/            # Active session documents
│   └── SESSION-YYYY-MM-DD-slug/
│       ├── plan.md
│       └── session.md
└── state/               # Verification state files
    └── verify-state.json
```

## COMMANDS

- `node scripts/verify.js` - Generate verification state with file hashes
- `node scripts/ship.js` - Validate integrity and prepare for shipping

## ENFORCING THE WORKFLOW

When the user requests changes:
1. Check if a plan exists for this work
2. If no plan, switch to PLAN phase first
3. If plan exists but not approved, request approval
4. If executing, ensure you're following the task order
5. If verifying, run all checks before proceeding
6. If shipping, validate integrity first

Always be explicit about which phase you're in and what gates need to be satisfied.

## JDEX-SPECIFIC NOTES

- This is an Electron app with React frontend
- Premium features are gated by license validation
- File operations require careful path validation
- Cloud drive detection varies by platform
- Always test with both free and premium tier scenarios
